<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CHUCK Player</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: black;
            overflow: hidden;
        }

        body {
            cursor: none;
        }

        #bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        #play-btn {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            font-size: 2rem;
            z-index: 10;
            cursor: pointer;
            display: none;
        }

        /* Time/Date bar */
        #time-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 15vh;
            background: black;
            color: red;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            letter-spacing: 2px;
            text-align: center;
        }

        #time-text {
            font-size: 5vh;
            line-height: 1;
        }

        #date-text {
            font-size: 3vh;
            margin-top: 0.7vh;
            letter-spacing: 3px;
        }
    </style>
</head>
<body>

    <div id="play-btn" onclick="forcePlay()">CLICK TO START</div>

    <video id="bg-video" loop autoplay muted playsinline>
        <source src="KOMUBARS-V1.mp4" type="video/mp4">
    </video>

    <div id="time-bar">
        <div id="time-text">--:--:--:--</div>
        <div id="date-text">LOADING DATE...</div>
    </div>

<script>
    const video = document.getElementById('bg-video');
    const btn = document.getElementById('play-btn');
    const timeText = document.getElementById('time-text');
    const dateText = document.getElementById('date-text');

    let offsetMS = 0;

    const FRAME_RATE = 29.97;
    const FRAME_DURATION = 1000 / FRAME_RATE;
    const TIMER_INTERVAL = Math.round(FRAME_DURATION);

    // ---------- VIDEO AUTOPLAY ----------
    const playPromise = video.play();
    if (playPromise !== undefined) {
        playPromise.catch(() => {
            btn.style.display = 'flex';
            document.body.style.cursor = 'auto';
        });
    }

    function forcePlay() {
        video.play();
        btn.style.display = 'none';
        document.body.style.cursor = 'none';
    }

    // ---------- TIME SYNC (subtract 3 seconds) ----------
    async function syncTime() {
        try {
            const response = await fetch("https://worldtimeapi.org/api/timezone/America/Chicago");
            const data = await response.json();

            // SUBTRACT 3 SECONDS INSTEAD OF ADDING
            const apiTime = (data.unixtime * 1000) - 3000;

            const pcTime = Date.now();

            offsetMS = apiTime - pcTime;
            console.log("Time synced. Offset (ms):", offsetMS);
        } catch (e) {
            console.warn("Time sync failed, using PC clock with -3s offset.");
            // fallback: subtract 3 seconds from PC time
            offsetMS = -3000;
        }
    }

    function formatTimecode(date) {
        const hh = String(date.getHours()).padStart(2, '0');
        const mm = String(date.getMinutes()).padStart(2, '0');
        const ss = String(date.getSeconds()).padStart(2, '0');

        const ms = date.getMilliseconds();
        const frame = Math.floor(ms / FRAME_DURATION);
        const ff = String(frame).padStart(2, '0');

        return `${hh}:${mm}:${ss}:${ff}`;
    }

    function formatDate(date) {
        const days = ["SUNDAY","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY"];
        const months = ["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];

        const dayName = days[date.getDay()];
        const monthName = months[date.getMonth()];
        const dayNum = String(date.getDate()).padStart(2, '0');
        const year = date.getFullYear();

        return `${dayName} ${monthName} ${dayNum} ${year}`;
    }

    function updateClock() {
        const now = new Date(Date.now() + offsetMS);
        timeText.textContent = formatTimecode(now);
        dateText.textContent = formatDate(now);
    }

    // Initial sync & looping updates
    syncTime();
    setInterval(syncTime, 15 * 60 * 1000);
    setInterval(updateClock, TIMER_INTERVAL);

</script>

</body>
</html>
