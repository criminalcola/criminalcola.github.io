<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CHUCK Player</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: black;
            overflow: hidden;
        }

        body {
            cursor: none; /* Hide cursor */
        }

        #bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0; /* Make sure video is behind overlays but still visible */
        }

        /* Only visible if autoplay fails */
        #play-btn {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            font-size: 2rem;
            z-index: 10;
            cursor: pointer;
            display: none; /* Hidden by default */
        }

        /* Clock bar: about 1/8 of the screen height at bottom */
        #time-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 12.5vh;      /* ~1/8 of screen height */
            background: black;
            color: red;
            font-family: monospace;
            font-size: 4vh;       /* scales with viewport */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <div id="play-btn" onclick="forcePlay()">CLICK TO START</div>

    <video id="bg-video" loop autoplay muted playsinline>
        <source src="KOMUBARS-V1.mp4" type="video/mp4">
    </video>

    <!-- Time Display -->
    <div id="time-bar">--:--:--.---</div>

<script>
    const video = document.getElementById('bg-video');
    const btn = document.getElementById('play-btn');
    const timeBar = document.getElementById('time-bar');

    let offsetMS = 0; // Difference between API time and PC time

    // ---------- VIDEO AUTOPLAY HANDLING ----------
    // Try to play immediately (in addition to autoplay attribute)
    const promise = video.play();
    if (promise !== undefined) {
        promise.catch(error => {
            console.log("Autoplay prevented. Waiting for user interaction.");
            btn.style.display = 'flex';
            document.body.style.cursor = 'auto'; // Show cursor so they can click
        });
    }

    function forcePlay() {
        video.play();
        btn.style.display = 'none';
        bodyHideCursor();
    }

    function bodyHideCursor() {
        document.body.style.cursor = 'none';
    }

    // ---------- TIME SYNC ----------
    async function syncTime() {
        try {
            const response = await fetch("https://worldtimeapi.org/api/timezone/America/Chicago");
            const data = await response.json();

            // UNIX time from API (ms), plus 3 seconds
            const apiTime = (data.unixtime * 1000) + 3000;

            const pcTime = Date.now();
            offsetMS = apiTime - pcTime;

            console.log("Time synced. Offset:", offsetMS, "ms");
        } catch (e) {
            console.warn("Time API failed. Using PC clock.");
            // offsetMS remains whatever it was (0 if never synced)
        }
    }

    function formatTime(date) {
        const hh = String(date.getHours()).padStart(2, '0');
        const mm = String(date.getMinutes()).padStart(2, '0');
        const ss = String(date.getSeconds()).padStart(2, '0');
        const ms = String(date.getMilliseconds()).padStart(3, '0');
        return `${hh}:${mm}:${ss}.${ms}`;
    }

    function updateClock() {
        const now = new Date(Date.now() + offsetMS);
        timeBar.textContent = formatTime(now);
    }

    // Initial sync
    syncTime();

    // Resync every 15 minutes
    setInterval(syncTime, 15 * 60 * 1000);

    // Update clock with millisecond precision (about 60fps)
    setInterval(updateClock, 16);
</script>

</body>
</html>
